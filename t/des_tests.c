#include "t.h"
#include "test_groups.h"
#include "des.h"

static int subkeys()
{
	uint64_t	key = 0x133457799BBCDFF1;
	uint64_t	subkeys[16];
	uint64_t	expected[16] = {
		0b0001101100000010111011111111110001110000011100100000000000000000,
		0b0111100110101110110110011101101111001001111001010000000000000000,
		0b0101010111111100100010100100001011001111100110010000000000000000,
		0b0111001010101101110101101101101100110101000111010000000000000000,
		0b0111110011101100000001111110101101010011101010000000000000000000,
		0b0110001110100101001111100101000001111011001011110000000000000000,
		0b1110110010000100101101111111011000011000101111000000000000000000,
		0b1111011110001010001110101100000100111011111110110000000000000000,
		0b1110000011011011111010111110110111100111100000010000000000000000,
		0b1011000111110011010001111011101001000110010011110000000000000000,
		0b0010000101011111110100111101111011010011100001100000000000000000,
		0b0111010101110001111101011001010001100111111010010000000000000000,
		0b1001011111000101110100011111101010111010010000010000000000000000,
		0b0101111101000011101101111111001011100111001110100000000000000000,
		0b1011111110010001100011010011110100111111000010100000000000000000,
		0b1100101100111101100010110000111000010111111101010000000000000000
	};

	generate_subkeys(key, subkeys);
	for (int i = 0; i < 16; i++) 
	{
		if (subkeys[i] != expected[i])
			return (1);
	}
	return (0);
}

static int	block_encryption()
{
	t_byte		message[] = {0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF};
	t_byte		expected[] = {0x85, 0xE8, 0x13, 0x54, 0x0F, 0x0A, 0xB4, 0x05};
	t_byte		output[8];
	uint64_t	key = 0x133457799BBCDFF1;
	uint64_t	subkeys[16];

	generate_subkeys(key, subkeys);
	des_core(subkeys, message, output);
	for (int i = 0; i < 8; i++)
		if (output[i] != expected[i])
			return (1);
	return (0);
}

int	des_tests()
{
	RUN_TEST(subkeys);
	RUN_TEST(block_encryption);
	return (0);
}
